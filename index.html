<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OTP Flow</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    margin:0;
    min-height:100vh;
    background:linear-gradient(135deg,#020024,#090979,#00d4ff);
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:system-ui;
    color:#fff
}
.box{
    width:420px;
    background:#0b0b0b;
    padding:24px;
    border-radius:16px;
    box-shadow:0 25px 60px rgba(0,0,0,.6)
}
h2{text-align:center;margin-bottom:16px}
input,button{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:none;
    outline:none;
    font-size:16px;
    margin-bottom:12px
}
button{
    background:linear-gradient(90deg,#00c6ff,#0072ff);
    color:#fff;
    cursor:pointer
}
.status{
    text-align:center;
    font-size:14px;
    margin-top:6px
}
.json{
    margin-top:16px;
    background:#000;
    padding:14px;
    border-radius:12px;
    max-height:320px;
    overflow:auto;
    font-family:monospace;
    font-size:13px;
    display:none
}
.k{color:#7dd3fc}
.s{color:#86efac}
.n{color:#fca5a5}
.b{color:#fde047}
.u{color:#c084fc}
.hide{display:none}
</style>
</head>

<body>
<div class="box">
    <h2>OTP Login</h2>

    <div id="step1">
        <input id="mobile" placeholder="Mobile Number" maxlength="10">
        <button onclick="sendOtp()">Send OTP</button>
    </div>

    <div id="step2" class="hide">
        <input id="otp" placeholder="Enter OTP">
        <button onclick="verifyOtp()">Verify OTP</button>
    </div>

    <div class="status" id="status"></div>
    <div class="json" id="json"></div>
</div>

<script>
const b64 = s => atob(s)

const SEND_OTP_URL = b64("aHR0cHM6Ly9sZWFybmluZy5tb3Rpb24uYWMuaW4vbW90aW9uZWR1Y2F0aW9uL2FwaS91c2VyL3NlbmQtb3Rw")
const VERIFY_OTP_URL = b64("aHR0cHM6Ly9sZWFybmluZy5tb3Rpb24uYWMuaW4vbW90aW9uZWR1Y2F0aW9uL2FwaS91c2VyL3ZlcmlmeS1vdHA=")
const TRIAL_URL = b64("aHR0cHM6Ly9sZWFybmluZy5tb3Rpb24uYWMuaW4vbW90aW9uZWR1Y2F0aW9uL2FwaS92MS9zdGFydFNtYXJ0VHJpYWw/cGFja2FnZV9pZD02MTg=")

let token = null
let mobileCache = null

function sendOtp(){
    const m = mobile.value.trim()
    if(m.length!==10){setStatus("Invalid number");return}
    mobileCache = m
    setStatus("Sending OTP...")
    fetch(SEND_OTP_URL,{
        method:"POST",
        headers:{
            "accept":"application/json",
            "content-type":"application/json"
        },
        body:JSON.stringify({mobile_number:m})
    })
    .then(r=>r.json())
    .then(j=>{
        render(j)
        if(j.status===200){
            step2.classList.remove("hide")
            setStatus(j.message)
        }else{
            setStatus("Failed to send OTP")
        }
    })
}

function verifyOtp(){
    const o = otp.value.trim()
    if(!o){setStatus("Enter OTP");return}
    setStatus("Verifying OTP...")
    fetch(VERIFY_OTP_URL,{
        method:"POST",
        headers:{
            "accept":"application/json",
            "content-type":"application/json"
        },
        body:JSON.stringify({
            mobile_number:mobileCache,
            otp:Number(o),
            firebaseToken:"fsAWnML6eLksNLJlxAamO8",
            loginType:"Web"
        })
    })
    .then(r=>r.json())
    .then(j=>{
        render(j)
        if(j.status===200){
            token=j.data.token
            setStatus("Login Successful")
            startTrial()
        }else{
            setStatus("Wrong OTP, try again")
        }
    })
}

function startTrial(){
    setStatus("Starting Smart Trial...")
    fetch(TRIAL_URL,{
        method:"POST",
        headers:{
            "accept":"application/json",
            "authorization":"Bearer "+token
        }
    })
    .then(r=>r.json())
    .then(j=>{
        render(j)
        setStatus("Done")
    })
}

function setStatus(t){
    status.innerText=t
}

function render(j){
    json.style.display="block"
    json.innerHTML=highlight(JSON.stringify(j,null,2))
}

function highlight(j){
    return j.replace(/("(.*?)"|\\b(true|false|null)\\b|\\d+)/g,m=>{
        if(m.startsWith('"'))return `<span class="s">${m}</span>`
        if(m==="true"||m==="false")return `<span class="b">${m}</span>`
        if(m==="null")return `<span class="u">${m}</span>`
        return `<span class="n">${m}</span>`
    })
}
</script>
</body>
</html>
